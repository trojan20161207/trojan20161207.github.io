<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="小冲的个人博客">
    <meta name="author" content="Devin hao">
    
    <title>
        
            Linux 系统日常巡检脚本 |
        
        Devin blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/null">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"www.devinrain.homes","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":null,"favicon":null,"avatar":"/images/logo.svg","font_size":null,"font_family":"STHeiti","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":null,"font_color":null,"hitokoto":true},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":false,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"center","copyright_info":false},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
               Devin blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">Linux 系统日常巡检脚本</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/logo.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Devin hao</span>
                            
                                <span class="author-label">Architect</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-02-04 14:45:17</span>
        <span class="mobile">2023-02-04 14:45</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-02-04 15:17:39</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Linux/">Linux</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Linux/">Linux</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>3.5k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>19 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <h3 id="主要巡检内容"><a href="#主要巡检内容" class="headerlink" title="主要巡检内容:"></a>主要巡检内容:</h3><p>磁盘、内存、cpu、进程、文件更改、用户登录等一系列的操作，开箱即用。报告以邮件发送到邮箱 在log下生成巡检报告。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># @Author: xiaochong2021</span>
<span class="token comment"># @Date:   2021-11-23 09:56:57</span>
<span class="token comment"># @Last Modified by:   xiaochong2021</span>
<span class="token comment"># @Last Modified time: 2021-11-23 11:56:57</span>
<span class="token comment"># @E-mail: 1530860548@qq.com</span>

<span class="token comment">#!/bin/bash</span>
<span class="token comment">#主机信息每日巡检</span>

<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ifconfig</span> eth0<span class="token operator">|</span><span class="token function">grep</span> <span class="token string">'inet addr'</span><span class="token operator">|</span><span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">'[ :]'</span> <span class="token string">'&#123;print $13&#125;'</span><span class="token variable">)</span></span>
<span class="token comment">#环境变量PATH没设好，在cron里执行时有很多命令会找不到</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
<span class="token builtin class-name">source</span> /etc/profile

<span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"请用root用户执行此脚本！"</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token assign-left variable">centosVersion</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'&#123;print $(NF-1)&#125;'</span> /etc/redhat-release<span class="token variable">)</span></span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"2021-11-23"</span>

<span class="token comment">#日志相关</span>
<span class="token assign-left variable">PROGPATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $0 <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">'s,[\\/][^\\/][^\\/]*$,,'</span><span class="token variable">`</span></span>
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token variable">$PROGPATH</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">PROGPATH</span><span class="token operator">=</span><span class="token string">"."</span>
<span class="token assign-left variable">LOGPATH</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$PROGPATH</span>/log"</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-e</span> <span class="token variable">$LOGPATH</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">mkdir</span> <span class="token variable">$LOGPATH</span>
<span class="token assign-left variable">RESULTFILE</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$LOGPATH</span>/HostDailyCheck-<span class="token variable">$IPADDR</span>-<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y%m%d<span class="token variable">`</span></span>.txt"</span>


<span class="token comment">#定义报表的全局变量</span>
<span class="token assign-left variable">report_DateTime</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#日期 ok</span>
<span class="token assign-left variable">report_Hostname</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#主机名 ok</span>
<span class="token assign-left variable">report_OSRelease</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#发行版本 ok</span>
<span class="token assign-left variable">report_Kernel</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#内核 ok</span>
<span class="token assign-left variable">report_Language</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#语言/编码 ok</span>
<span class="token assign-left variable">report_LastReboot</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#最近启动时间 ok</span>
<span class="token assign-left variable">report_Uptime</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#运行时间（天） ok</span>
<span class="token assign-left variable">report_CPUs</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#CPU数量 ok</span>
<span class="token assign-left variable">report_CPUType</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#CPU类型 ok</span>
<span class="token assign-left variable">report_Arch</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#CPU架构 ok</span>
<span class="token assign-left variable">report_MemTotal</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#内存总容量(MB) ok</span>
<span class="token assign-left variable">report_MemFree</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#内存剩余(MB) ok</span>
<span class="token assign-left variable">report_MemUsedPercent</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#内存使用率% ok</span>
<span class="token assign-left variable">report_DiskTotal</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#硬盘总容量(GB) ok</span>
<span class="token assign-left variable">report_DiskFree</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#硬盘剩余(GB) ok</span>
<span class="token assign-left variable">report_DiskUsedPercent</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#硬盘使用率% ok</span>
<span class="token assign-left variable">report_InodeTotal</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#Inode总量 ok</span>
<span class="token assign-left variable">report_InodeFree</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#Inode剩余 ok</span>
<span class="token assign-left variable">report_InodeUsedPercent</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#Inode使用率 ok</span>
<span class="token assign-left variable">report_IP</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#IP地址 ok</span>
<span class="token assign-left variable">report_MAC</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#MAC地址 ok</span>
<span class="token assign-left variable">report_Gateway</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#默认网关 ok</span>
<span class="token assign-left variable">report_DNS</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#DNS ok</span>
<span class="token assign-left variable">report_Listen</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#监听 ok</span>
<span class="token assign-left variable">report_Selinux</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#Selinux ok</span>
<span class="token assign-left variable">report_Firewall</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#防火墙 ok</span>
<span class="token assign-left variable">report_USERs</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#用户 ok</span>
<span class="token assign-left variable">report_USEREmptyPassword</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#空密码用户 ok</span>
<span class="token assign-left variable">report_USERTheSameUID</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#相同ID的用户 ok </span>
<span class="token assign-left variable">report_PasswordExpiry</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#密码过期（天） ok</span>
<span class="token assign-left variable">report_RootUser</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#root用户 ok</span>
<span class="token assign-left variable">report_Sudoers</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#sudo授权 ok</span>
<span class="token assign-left variable">report_SSHAuthorized</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#SSH信任主机 ok</span>
<span class="token assign-left variable">report_SSHDProtocolVersion</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#SSH协议版本 ok</span>
<span class="token assign-left variable">report_SSHDPermitRootLogin</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#允许root远程登录 ok</span>
<span class="token assign-left variable">report_DefunctProsess</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#僵尸进程数量 ok</span>
<span class="token assign-left variable">report_SelfInitiatedService</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#自启动服务数量 ok</span>
<span class="token assign-left variable">report_SelfInitiatedProgram</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#自启动程序数量 ok</span>
<span class="token assign-left variable">report_RuningService</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#运行中服务数 ok</span>
<span class="token assign-left variable">report_Crontab</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#计划任务数 ok</span>
<span class="token assign-left variable">report_Syslog</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#日志服务 ok</span>
<span class="token assign-left variable">report_SNMP</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#SNMP OK</span>
<span class="token assign-left variable">report_NTP</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#NTP ok</span>
<span class="token assign-left variable">report_JDK</span><span class="token operator">=</span><span class="token string">""</span> <span class="token comment">#JDK版本 ok</span>
<span class="token keyword">function</span> <span class="token function-name function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"系统巡检脚本：Version <span class="token variable">$VERSION</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getCpuStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ CPU检查 #############################"</span>
<span class="token assign-left variable">Physical_CPUs</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"physical id"</span> /proc/cpuinfo<span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token assign-left variable">Virt_CPUs</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"processor"</span> /proc/cpuinfo <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token assign-left variable">CPU_Kernels</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"cores"</span> /proc/cpuinfo<span class="token operator">|</span><span class="token function">uniq</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">': '</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">CPU_Type</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"model name"</span> /proc/cpuinfo <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">': '</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span><span class="token variable">)</span></span>
<span class="token assign-left variable">CPU_Arch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"物理CPU个数:<span class="token variable">$Physical_CPUs</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"逻辑CPU个数:<span class="token variable">$Virt_CPUs</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"每CPU核心数:<span class="token variable">$CPU_Kernels</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" CPU型号:<span class="token variable">$CPU_Type</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" CPU架构:<span class="token variable">$CPU_Arch</span>"</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_CPUs</span><span class="token operator">=</span><span class="token variable">$Virt_CPUs</span> <span class="token comment">#CPU数量</span>
<span class="token assign-left variable">report_CPUType</span><span class="token operator">=</span><span class="token variable">$CPU_Type</span> <span class="token comment">#CPU类型</span>
<span class="token assign-left variable">report_Arch</span><span class="token operator">=</span><span class="token variable">$CPU_Arch</span> <span class="token comment">#CPU架构</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getMemStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 内存检查 ############################"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$centosVersion</span> <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token function">free</span> <span class="token parameter variable">-mo</span>
<span class="token keyword">else</span>
<span class="token function">free</span> <span class="token parameter variable">-h</span>
<span class="token keyword">fi</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">MemTotal</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> MemTotal /proc/meminfo<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span> <span class="token comment">#KB</span>
<span class="token assign-left variable">MemFree</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> MemFree /proc/meminfo<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span> <span class="token comment">#KB</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">MemUsed</span><span class="token operator">=</span>MemTotal-MemFree
<span class="token assign-left variable">MemPercent</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">"BEGIN &#123;if(<span class="token variable">$MemTotal</span>==0)&#123;printf 100&#125;else&#123;printf <span class="token entity" title="\&quot;">\"</span>%.2f<span class="token entity" title="\&quot;">\"</span>,<span class="token variable">$MemUsed</span>*100/<span class="token variable">$MemTotal</span>&#125;&#125;"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">report_MemTotal</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$((</span>MemTotal<span class="token operator">/</span><span class="token number">1024</span><span class="token variable">))</span></span>"</span>"MB<span class="token string">" #内存总容量(MB)
report_MemFree="</span><span class="token variable"><span class="token variable">$((</span>MemFree<span class="token operator">/</span><span class="token number">1024</span><span class="token variable">))</span></span><span class="token string">""</span>MB<span class="token string">" #内存剩余(MB)
report_MemUsedPercent="</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">"BEGIN &#123;if(<span class="token variable">$MemTotal</span>==0)&#123;printf 100&#125;else&#123;printf <span class="token entity" title="\&quot;">\"</span>%.2f<span class="token entity" title="\&quot;">\"</span>,<span class="token variable">$MemUsed</span>*100/<span class="token variable">$MemTotal</span>&#125;&#125;"</span><span class="token variable">)</span></span><span class="token string">""</span>%<span class="token string">" #内存使用率%
&#125;
function getDiskStatus()&#123;
echo "</span>"
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 磁盘检查 ############################"</span>
<span class="token function">df</span> <span class="token parameter variable">-hiP</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/Mounted on/Mounted/'</span><span class="token operator">></span> /tmp/inode
<span class="token function">df</span> <span class="token parameter variable">-hTP</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/Mounted on/Mounted/'</span><span class="token operator">></span> /tmp/disk 
<span class="token function">join</span> /tmp/disk /tmp/inode <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1,$2,"|",$3,$4,$5,$6,"|",$8,$9,$10,$11,"|",$12&#125;'</span><span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">diskdata</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">df</span> <span class="token parameter variable">-TP</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1d'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'$2!="tmpfs"&#123;print&#125;'</span><span class="token variable">)</span></span> <span class="token comment">#KB</span>
<span class="token assign-left variable">disktotal</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$diskdata</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;total+=$3&#125;END&#123;print total&#125;'</span><span class="token variable">)</span></span> <span class="token comment">#KB</span>
<span class="token assign-left variable">diskused</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$diskdata</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;total+=$4&#125;END&#123;print total&#125;'</span><span class="token variable">)</span></span> <span class="token comment">#KB</span>
<span class="token assign-left variable">diskfree</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>disktotal<span class="token operator">-</span>diskused<span class="token variable">))</span></span> <span class="token comment">#KB</span>
<span class="token assign-left variable">diskusedpercent</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $disktotal $diskused <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;if($1==0)&#123;printf 100&#125;else&#123;printf "%.2f",$2*100/$1&#125;&#125;'</span><span class="token variable">)</span></span> 
<span class="token assign-left variable">inodedata</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">df</span> <span class="token parameter variable">-iTP</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1d'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'$2!="tmpfs"&#123;print&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">inodetotal</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$inodedata</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;total+=$3&#125;END&#123;print total&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">inodeused</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$inodedata</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;total+=$4&#125;END&#123;print total&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">inodefree</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>inodetotal<span class="token operator">-</span>inodeused<span class="token variable">))</span></span>
<span class="token assign-left variable">inodeusedpercent</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $inodetotal $inodeused <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;if($1==0)&#123;printf 100&#125;else&#123;printf "%.2f",$2*100/$1&#125;&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">report_DiskTotal</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>disktotal<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token variable">))</span></span><span class="token string">"GB"</span> <span class="token comment">#硬盘总容量(GB)</span>
<span class="token assign-left variable">report_DiskFree</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>diskfree<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token variable">))</span></span><span class="token string">"GB"</span> <span class="token comment">#硬盘剩余(GB)</span>
<span class="token assign-left variable">report_DiskUsedPercent</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$diskusedpercent</span>"</span>"%<span class="token string">" #硬盘使用率%
report_InodeTotal=<span class="token variable"><span class="token variable">$((</span>inodetotal<span class="token operator">/</span><span class="token number">1000</span><span class="token variable">))</span></span>"</span>K<span class="token string">" #Inode总量
report_InodeFree=<span class="token variable"><span class="token variable">$((</span>inodefree<span class="token operator">/</span><span class="token number">1000</span><span class="token variable">))</span></span>"</span>K<span class="token string">" #Inode剩余
report_InodeUsedPercent="</span><span class="token variable">$inodeusedpercent</span><span class="token string">""</span>%<span class="token string">" #Inode使用率%

&#125;

function getSystemStatus()&#123;
echo "</span>"
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 系统检查 ############################"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> /etc/sysconfig/i18n <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">default_LANG</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"LANG="</span> /etc/sysconfig/i18n <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">'"'</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span>"</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">default_LANG</span><span class="token operator">=</span><span class="token environment constant">$LANG</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span>
<span class="token assign-left variable">Release</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/redhat-release <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token variable">)</span></span>
<span class="token assign-left variable">Kernel</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>
<span class="token assign-left variable">OS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-o</span><span class="token variable">)</span></span>
<span class="token assign-left variable">Hostname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-n</span><span class="token variable">)</span></span>
<span class="token assign-left variable">SELinux</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>/usr/sbin/sestatus <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"SELinux status: "</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">LastReboot</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">who</span> <span class="token parameter variable">-b</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $3,$4&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">uptime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uptime</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/.*up \([^,]*\), .*/\1/'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">" 系统：<span class="token variable">$OS</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 发行版本：<span class="token variable">$Release</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 内核：<span class="token variable">$Kernel</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 主机名：<span class="token variable">$Hostname</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" SELinux：<span class="token variable">$SELinux</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"语言/编码：<span class="token variable">$default_LANG</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 当前时间：<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%F %T'</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 最后启动：<span class="token variable">$LastReboot</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">" 运行时间：<span class="token variable">$uptime</span>"</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_DateTime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">"%F %T"</span><span class="token variable">)</span></span> <span class="token comment">#日期</span>
<span class="token assign-left variable">report_Hostname</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$Hostname</span>"</span> <span class="token comment">#主机名</span>
<span class="token assign-left variable">report_OSRelease</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$Release</span>"</span> <span class="token comment">#发行版本</span>
<span class="token assign-left variable">report_Kernel</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$Kernel</span>"</span> <span class="token comment">#内核</span>
<span class="token assign-left variable">report_Language</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$default_LANG</span>"</span> <span class="token comment">#语言/编码</span>
<span class="token assign-left variable">report_LastReboot</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$LastReboot</span>"</span> <span class="token comment">#最近启动时间</span>
<span class="token assign-left variable">report_Uptime</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$uptime</span>"</span> <span class="token comment">#运行时间（天）</span>
<span class="token assign-left variable">report_Selinux</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$SELinux</span>"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$default_LANG</span>"</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getServiceStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 服务检查 ############################"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$centosVersion</span> <span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">conf</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>systemctl list-unit-files <span class="token parameter variable">--type</span><span class="token operator">=</span>service <span class="token parameter variable">--state</span><span class="token operator">=</span>enabled --no-pager <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"enabled"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">process</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>systemctl list-units <span class="token parameter variable">--type</span><span class="token operator">=</span>service <span class="token parameter variable">--state</span><span class="token operator">=</span>running --no-pager <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">".service"</span><span class="token variable">)</span></span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_SelfInitiatedService</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$conf</span>"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span> <span class="token comment">#自启动服务数量</span>
<span class="token assign-left variable">report_RuningService</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$process</span>"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span> <span class="token comment">#运行中服务数量</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">conf</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>/sbin/chkconfig <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">":on|:启用"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">process</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>/sbin/service --status-all <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">"is running|正在运行"</span><span class="token variable">)</span></span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_SelfInitiatedService</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$conf</span>"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span> <span class="token comment">#自启动服务数量</span>
<span class="token assign-left variable">report_RuningService</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$process</span>"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span> <span class="token comment">#运行中服务数量</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">"服务配置"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$conf</span>"</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"正在运行的服务"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------------"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$process</span>"</span>

<span class="token punctuation">&#125;</span>


<span class="token keyword">function</span> <span class="token function-name function">getAutoStartStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 自启动检查 ##########################"</span>
<span class="token assign-left variable">conf</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> /etc/rc.d/rc.local<span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$conf</span>"</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_SelfInitiatedProgram</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $conf <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span> <span class="token comment">#自启动程序数量</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getLoginStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 登录检查 ############################"</span>
last <span class="token operator">|</span> <span class="token function">head</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getNetworkStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 网络检查 ############################"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$centosVersion</span> <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
/sbin/ifconfig <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> packets <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> collisions <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> inet6
<span class="token keyword">else</span>
<span class="token comment">#ip a</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ip</span> <span class="token function">link</span> <span class="token operator">|</span> <span class="token function">grep</span> BROADCAST <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">ip</span> <span class="token function">add</span> show <span class="token variable">$i</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">"BROADCAST|global"</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">' '</span> <span class="token punctuation">;</span><span class="token builtin class-name">echo</span> <span class="token string">""</span> <span class="token punctuation">;</span><span class="token keyword">done</span>
<span class="token keyword">fi</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ip</span> route <span class="token operator">|</span> <span class="token function">grep</span> default <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">DNS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> nameserver /etc/resolv.conf<span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"#"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">','</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"网关：<span class="token variable">$GATEWAY</span> "</span>
<span class="token builtin class-name">echo</span> <span class="token string">" DNS：<span class="token variable">$DNS</span>"</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ip</span> <span class="token parameter variable">-f</span> inet addr <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token number">127.0</span>.0.1 <span class="token operator">|</span> <span class="token function">grep</span> inet <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $NF,$2&#125;'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">','</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$//'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">MAC</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ip</span> <span class="token function">link</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"LOOPBACK\|loopback"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'N;s/\n//'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">','</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$//'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">report_IP</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$IP</span>"</span> <span class="token comment">#IP地址</span>
<span class="token assign-left variable">report_MAC</span><span class="token operator">=</span><span class="token variable">$MAC</span> <span class="token comment">#MAC地址</span>
<span class="token assign-left variable">report_Gateway</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$GATEWAY</span>"</span> <span class="token comment">#默认网关</span>
<span class="token assign-left variable">report_DNS</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$DNS</span>"</span> <span class="token comment">#DNS</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getListenStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 监听检查 ############################"</span>
<span class="token assign-left variable">TCPListen</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>ss <span class="token parameter variable">-ntul</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$TCPListen</span>"</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_Listen</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$TCPListen</span>"</span><span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1d'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/tcp/ &#123;print $5&#125;'</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $NF&#125;'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getCronStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 计划任务检查 ########################"</span>
<span class="token assign-left variable">Crontab</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">shell</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"/sbin/nologin"</span> /etc/shells<span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">user</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">"<span class="token variable">$shell</span>"</span> /etc/passwd<span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
<span class="token function">crontab</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">-u</span> <span class="token variable">$user</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable">$?</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$status</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$user</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------"</span>
<span class="token function">crontab</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">-u</span> <span class="token variable">$user</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">Crontab</span><span class="token operator">=</span>Crontab+<span class="token variable"><span class="token variable">$(</span><span class="token function">crontab</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">-u</span> $user <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token keyword">fi</span>
<span class="token keyword">done</span>
<span class="token keyword">done</span>
<span class="token comment">#计划任务</span>
<span class="token function">find</span> /etc/cron* <span class="token parameter variable">-type</span> f <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-i</span> <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">Crontab</span><span class="token operator">=</span>Crontab+<span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /etc/cron* <span class="token parameter variable">-type</span> f <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_Crontab</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$Crontab</span>"</span> <span class="token comment">#计划任务数</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">getHowLongAgo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token comment"># 计算一个时间戳离现在有多久了</span>
<span class="token assign-left variable">datetime</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$*</span>"</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$datetime</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"错误的参数：getHowLongAgo() <span class="token variable">$*</span>"</span>
<span class="token assign-left variable">Timestamp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$datetime</span>"</span><span class="token variable">)</span></span> <span class="token comment">#转化为时间戳</span>
<span class="token assign-left variable">Now_Timestamp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
<span class="token assign-left variable">Difference_Timestamp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$Now_Timestamp<span class="token operator">-</span>$Timestamp<span class="token variable">))</span></span>
<span class="token assign-left variable">days</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token assign-left variable">hours</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token assign-left variable">minutes</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token assign-left variable">sec_in_day</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token variable">))</span></span><span class="token punctuation">;</span>
<span class="token assign-left variable">sec_in_hour</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token variable">))</span></span><span class="token punctuation">;</span>
<span class="token assign-left variable">sec_in_minute</span><span class="token operator">=</span><span class="token number">60</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span> $<span class="token punctuation">((</span>$Difference_Timestamp<span class="token operator">-</span>$sec_in_day<span class="token punctuation">))</span></span> <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">))</span>
<span class="token keyword">do</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">Difference_Timestamp</span><span class="token operator">=</span>Difference_Timestamp-sec_in_day
<span class="token builtin class-name">let</span> days++
<span class="token keyword">done</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span> $<span class="token punctuation">((</span>$Difference_Timestamp<span class="token operator">-</span>$sec_in_hour<span class="token punctuation">))</span></span> <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">))</span>
<span class="token keyword">do</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">Difference_Timestamp</span><span class="token operator">=</span>Difference_Timestamp-sec_in_hour
<span class="token builtin class-name">let</span> hours++
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$days</span> 天 <span class="token variable">$hours</span> 小时前"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getUserLastLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token comment"># 获取用户最近一次登录的时间，含年份</span>
<span class="token comment"># 很遗憾last命令不支持显示年份，只有"last -t YYYYMMDDHHMMSS"表示某个时间之间的登录，我</span>
<span class="token comment"># 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户</span>
<span class="token comment"># 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。</span>
<span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">:</span> <span class="token variable">$&#123;username<span class="token operator">:=</span>"`whoami`"&#125;</span>
<span class="token assign-left variable">thisYear</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y<span class="token variable">)</span></span>
<span class="token assign-left variable">oldesYear</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>last <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $NF&#125;'</span><span class="token variable">)</span></span>
<span class="token keyword">while</span><span class="token variable"><span class="token punctuation">((</span> $thisYear <span class="token operator">>=</span> $oldesYear<span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
<span class="token assign-left variable">loginBeforeToday</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>last $username <span class="token operator">|</span> <span class="token function">grep</span> $username <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token assign-left variable">loginBeforeNewYearsDayOfThisYear</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>last $username <span class="token parameter variable">-t</span> $thisYear<span class="token string">"0101000000"</span> <span class="token operator">|</span> <span class="token function">grep</span> $username <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$loginBeforeToday</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"从未登录过"</span>
<span class="token builtin class-name">break</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$loginBeforeToday</span> <span class="token parameter variable">-gt</span> <span class="token variable">$loginBeforeNewYearsDayOfThisYear</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">lastDateTime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>last <span class="token parameter variable">-i</span> $username <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">awk</span> '<span class="token punctuation">&#123;</span>for<span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token punctuation">(</span>NF-2<span class="token punctuation">)</span><span class="token punctuation">;</span>i++<span class="token variable">)</span></span><span class="token builtin class-name">printf</span><span class="token string">"%s "</span>,<span class="token variable">$i</span><span class="token punctuation">&#125;</span><span class="token string">')" $thisYear" #格式如: Sat Nov 2 20:33 2015
lastDateTime=$(date "+%Y-%m-%d %H:%M:%S" -d "$lastDateTime")
echo "$lastDateTime"
break
else
thisYear=$((thisYear-1))
fi
done

&#125;

function getUserStatus()&#123;
echo ""
echo ""
echo "############################ 用户检查 ############################"
#/etc/passwd 最后修改时间
pwdfile="$(cat /etc/passwd)"
Modify=$(stat /etc/passwd | grep Modify | tr '</span><span class="token builtin class-name">.</span><span class="token string">' '</span> <span class="token string">' | awk '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$2</span>,<span class="token variable">$3</span><span class="token punctuation">&#125;</span><span class="token string">')

echo "/etc/passwd 最后修改时间：$Modify ($(getHowLongAgo $Modify))"
echo ""
echo "特权用户"
echo "--------"
RootUser=""
for user in $(echo "$pwdfile" | awk -F: '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$1</span><span class="token punctuation">&#125;</span><span class="token string">');do
if [ $(id -u $user) -eq 0 ];then
echo "$user"
RootUser="$RootUser,$user"
fi
done
echo ""
echo "用户列表"
echo "--------"
USERs=0
echo "$(
echo "用户名 UID GID HOME SHELL 最后一次登录"
for shell in $(grep -v "/sbin/nologin" /etc/shells);do
for username in $(grep "$shell" /etc/passwd| awk -F: '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$1</span><span class="token punctuation">&#125;</span><span class="token string">');do
userLastLogin="$(getUserLastLogin $username)"
echo "$pwdfile" | grep -w "$username" |grep -w "$shell"| awk -F: -v lastlogin="$(echo "$userLastLogin" | tr '</span> <span class="token string">' '</span>_<span class="token string">')" '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$1</span>,<span class="token variable">$3</span>,<span class="token variable">$4</span>,<span class="token variable">$6</span>,<span class="token variable">$7</span>,lastlogin<span class="token punctuation">&#125;</span><span class="token string">'
done
let USERs=USERs+$(echo "$pwdfile" | grep "$shell"| wc -l)
done
)" | column -t
echo ""
echo "空密码用户"
echo "----------"
USEREmptyPassword=""
for shell in $(grep -v "/sbin/nologin" /etc/shells);do
for user in $(echo "$pwdfile" | grep "$shell" | cut -d: -f1);do
r=$(awk -F: '</span><span class="token variable">$2</span><span class="token operator">==</span><span class="token string">"!!"</span><span class="token punctuation">&#123;</span>print <span class="token variable">$1</span><span class="token punctuation">&#125;</span><span class="token string">' /etc/shadow | grep -w $user)
if [ ! -z $r ];then
echo $r
USEREmptyPassword="$USEREmptyPassword,"$r
fi
done 
done
echo ""
echo "相同ID的用户"
echo "------------"
USERTheSameUID=""
UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '</span><span class="token variable">$1</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">&#123;</span>print <span class="token variable">$2</span><span class="token punctuation">&#125;</span><span class="token string">')
for uid in $UIDs;do
echo -n "$uid";
USERTheSameUID="$uid"
r=$(awk -F: '</span><span class="token assign-left variable">ORS</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span><span class="token variable">$3</span><span class="token operator">==</span><span class="token string">'"$uid"'</span><span class="token punctuation">&#123;</span>print <span class="token string">":"</span>,<span class="token variable">$1</span><span class="token punctuation">&#125;</span><span class="token string">' /etc/passwd)
echo "$r"
echo ""
USERTheSameUID="$USERTheSameUID $r,"
done
#报表信息
report_USERs="$USERs" #用户
report_USEREmptyPassword=$(echo $USEREmptyPassword | sed '</span>s/^,//<span class="token string">') 
report_USERTheSameUID=$(echo $USERTheSameUID | sed '</span>s/,$//<span class="token string">') 
report_RootUser=$(echo $RootUser | sed '</span>s/^,//<span class="token string">') #特权用户
&#125;


function getPasswordStatus &#123;
echo ""
echo ""
echo "############################ 密码检查 ############################"
pwdfile="$(cat /etc/passwd)"
echo ""
echo "密码过期检查"
echo "------------"
result=""
for shell in $(grep -v "/sbin/nologin" /etc/shells);do
for user in $(echo "$pwdfile" | grep "$shell" | cut -d: -f1);do
get_expiry_date=$(/usr/bin/chage -l $user | grep '</span>Password expires<span class="token string">' | cut -d: -f2)
if [[ $get_expiry_date = '</span> never<span class="token string">' || $get_expiry_date = '</span>never<span class="token string">' ]];then
printf "%-15s 永不过期\n" $user
result="$result,$user:never"
else
password_expiry_date=$(date -d "$get_expiry_date" "+%s")
current_date=$(date "+%s")
diff=$(($password_expiry_date-$current_date))
let DAYS=$(($diff/(60*60*24)))
printf "%-15s %s天后过期\n" $user $DAYS
result="$result,$user:$DAYS days"
fi
done
done
report_PasswordExpiry=$(echo $result | sed '</span>s/^,//<span class="token string">')

echo ""
echo "密码策略检查"
echo "------------"
grep -v "#" /etc/login.defs | grep -E "PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE"


&#125;

function getSudoersStatus()&#123;
echo ""
echo ""
echo "############################ Sudoers检查 #########################"
conf=$(grep -v "^#" /etc/sudoers| grep -v "^Defaults" | sed '</span>/^$/d<span class="token string">')
echo "$conf"
echo ""
#报表信息
report_Sudoers="$(echo $conf | wc -l)"
&#125;

function getInstalledStatus()&#123;
echo ""
echo ""
echo "############################ 软件检查 ############################"
rpm -qa --last | head | column -t 
&#125;

function getProcessStatus()&#123;
echo ""
echo ""
echo "############################ 进程检查 ############################"
if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then
echo ""
echo "僵尸进程";
echo "--------"
ps -ef | head -n1
ps -ef | grep defunct | grep -v grep
fi
echo ""
echo "内存占用TOP10"
echo "-------------"
echo -e "PID %MEM RSS COMMAND
$(ps aux | awk '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$2</span>, <span class="token variable">$4</span>, <span class="token variable">$6</span>, <span class="token variable">$11</span><span class="token punctuation">&#125;</span><span class="token string">' | sort -k3rn | head -n 10 )"| column -t 
echo ""
echo "CPU占用TOP10"
echo "------------"
top b -n1 | head -17 | tail -11
#报表信息
report_DefunctProsess="$(ps -ef | grep defunct | grep -v grep|wc -l)"
&#125;

function getJDKStatus()&#123;
echo ""
echo ""
echo "############################ JDK检查 #############################"
java -version 2>/dev/null
if [ $? -eq 0 ];then
java -version 2>&amp;1
fi
echo "JAVA_HOME=\"$JAVA_HOME\""
#报表信息
report_JDK="$(java -version 2>&amp;1 | grep version | awk '</span><span class="token punctuation">&#123;</span>print <span class="token variable">$1</span>,<span class="token variable">$3</span><span class="token punctuation">&#125;</span><span class="token string">' | tr -d '</span><span class="token string">"')"</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">getSyslogStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ syslog检查 ##########################"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"服务状态：<span class="token variable"><span class="token variable">$(</span>getState rsyslog<span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"/etc/rsyslog.conf"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"-----------------"</span>
<span class="token function">cat</span> /etc/rsyslog.conf <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^<span class="token entity" title="\\">\\</span>$"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_Syslog</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>getState rsyslog<span class="token variable">)</span></span>"</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">getFirewallStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 防火墙检查 ##########################"</span>
<span class="token comment">#防火墙状态，策略等</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$centosVersion</span> <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
/etc/init.d/iptables status <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable">$?</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$status</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span><span class="token string">"active"</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$status</span> <span class="token parameter variable">-eq</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span><span class="token string">"inactive"</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$status</span> <span class="token parameter variable">-eq</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span><span class="token string">"permission denied"</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span><span class="token string">"unknown"</span>
<span class="token keyword">fi</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>getState iptables<span class="token variable">)</span></span>"</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">"iptables: <span class="token variable">$s</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"/etc/sysconfig/iptables"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"-----------------------"</span>
<span class="token function">cat</span> /etc/sysconfig/iptables <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_Firewall</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$s</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getSNMPStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token comment">#SNMP服务状态，配置等</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ SNMP检查 ############################"</span>
<span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>getState snmpd<span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"服务状态：<span class="token variable">$status</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> /etc/snmp/snmpd.conf <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"/etc/snmp/snmpd.conf"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------------------"</span>
<span class="token function">cat</span> /etc/snmp/snmpd.conf <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span>
<span class="token keyword">fi</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_SNMP</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>getState snmpd<span class="token variable">)</span></span>"</span>
<span class="token punctuation">&#125;</span>



<span class="token keyword">function</span> <span class="token function-name function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$centosVersion</span> <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> <span class="token string">"/etc/init.d/<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span>/etc/init.d/$1 status <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">"is running|正在运行"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span> <span class="token parameter variable">-ge</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">r</span><span class="token operator">=</span><span class="token string">"active"</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">r</span><span class="token operator">=</span><span class="token string">"inactive"</span>
<span class="token keyword">fi</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">r</span><span class="token operator">=</span><span class="token string">"unknown"</span>
<span class="token keyword">fi</span>
<span class="token keyword">else</span>
<span class="token comment">#CentOS 7+</span>
<span class="token assign-left variable">r</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>systemctl is-active $1 <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token variable">)</span></span>"</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$r</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getSSHStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token comment">#SSHD服务状态，配置,受信任主机等</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ SSH检查 #############################"</span>
<span class="token comment">#检查受信任主机</span>
<span class="token assign-left variable">pwdfile</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/passwd<span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"服务状态：<span class="token variable"><span class="token variable">$(</span>getState sshd<span class="token variable">)</span></span>"</span>
<span class="token assign-left variable">Protocol_Version</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/ssh/sshd_config <span class="token operator">|</span> <span class="token function">grep</span> Protocol <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"SSH协议版本：<span class="token variable">$Protocol_Version</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"信任主机"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------"</span>
<span class="token assign-left variable">authorized</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">user</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$pwdfile</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> /bin/bash <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
<span class="token assign-left variable">authorize_file</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$pwdfile</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> $user <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'&#123;printf $6"/.ssh/authorized_keys"&#125;'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">authorized_host</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $authorize_file <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">','</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$//'</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-z</span> <span class="token variable">$authorized_host</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$user</span> 授权 <span class="token entity" title="\&quot;">\"</span><span class="token variable">$authorized_host</span><span class="token entity" title="\&quot;">\"</span> 无密码访问"</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">let</span> <span class="token assign-left variable">authorized</span><span class="token operator">=</span>authorized+<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $authorize_file <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"是否允许ROOT远程登录"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------------------"</span>
<span class="token assign-left variable">config</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/ssh/sshd_config <span class="token operator">|</span> <span class="token function">grep</span> PermitRootLogin<span class="token variable">)</span></span>
<span class="token assign-left variable">firstChar</span><span class="token operator">=</span><span class="token variable">$&#123;config<span class="token operator">:</span>0<span class="token operator">:</span>1&#125;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$firstChar</span> <span class="token operator">==</span> <span class="token string">"#"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token assign-left variable">PermitRootLogin</span><span class="token operator">=</span><span class="token string">"yes"</span> <span class="token comment">#默认是允许ROOT远程登录的</span>
<span class="token keyword">else</span>
<span class="token assign-left variable">PermitRootLogin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $config <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">"PermitRootLogin <span class="token variable">$PermitRootLogin</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"/etc/ssh/sshd_config"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"--------------------"</span>
<span class="token function">cat</span> /etc/ssh/sshd_config <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span>

<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_SSHAuthorized</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$authorized</span>"</span> <span class="token comment">#SSH信任主机</span>
<span class="token assign-left variable">report_SSHDProtocolVersion</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$Protocol_Version</span>"</span> <span class="token comment">#SSH协议版本</span>
<span class="token assign-left variable">report_SSHDPermitRootLogin</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$PermitRootLogin</span>"</span> <span class="token comment">#允许root远程登录</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">getNTPStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token comment">#NTP服务状态，当前时间，配置等</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ NTP检查 #############################"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> /etc/ntp.conf <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"服务状态：<span class="token variable"><span class="token variable">$(</span>getState ntpd<span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"/etc/ntp.conf"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"-------------"</span>
<span class="token function">cat</span> /etc/ntp.conf <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span>
<span class="token keyword">fi</span>
<span class="token comment">#报表信息</span>
<span class="token assign-left variable">report_NTP</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>getState ntpd<span class="token variable">)</span></span>"</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">function</span> <span class="token function-name function">uploadHostDailyCheckReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token assign-left variable">json</span><span class="token operator">=</span><span class="token string">"&#123;
<span class="token entity" title="\&quot;">\"</span>DateTime<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DateTime</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Hostname<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Hostname</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>OSRelease<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_OSRelease</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Kernel<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Kernel</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Language<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Language</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>LastReboot<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_LastReboot</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Uptime<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Uptime</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>CPUs<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_CPUs</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>CPUType<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_CPUType</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Arch<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Arch</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>MemTotal<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_MemTotal</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>MemFree<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_MemFree</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>MemUsedPercent<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_MemUsedPercent</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>DiskTotal<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DiskTotal</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>DiskFree<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DiskFree</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>DiskUsedPercent<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DiskUsedPercent</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>InodeTotal<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_InodeTotal</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>InodeFree<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_InodeFree</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>InodeUsedPercent<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_InodeUsedPercent</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>IP<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_IP</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>MAC<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_MAC</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Gateway<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Gateway</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>DNS<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DNS</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Listen<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Listen</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Selinux<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Selinux</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Firewall<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Firewall</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>USERs<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_USERs</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>USEREmptyPassword<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_USEREmptyPassword</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>USERTheSameUID<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_USERTheSameUID</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>PasswordExpiry<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_PasswordExpiry</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>RootUser<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_RootUser</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Sudoers<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Sudoers</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SSHAuthorized<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SSHAuthorized</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SSHDProtocolVersion<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SSHDProtocolVersion</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SSHDPermitRootLogin<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SSHDPermitRootLogin</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>DefunctProsess<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_DefunctProsess</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SelfInitiatedService<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SelfInitiatedService</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SelfInitiatedProgram<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SelfInitiatedProgram</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>RuningService<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_RuningService</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Crontab<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Crontab</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>Syslog<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_Syslog</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>SNMP<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_SNMP</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>NTP<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_NTP</span><span class="token entity" title="\&quot;">\"</span>,
<span class="token entity" title="\&quot;">\"</span>JDK<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$report_JDK</span><span class="token entity" title="\&quot;">\"</span>
&#125;"</span>
<span class="token comment">#echo "$json" </span>
<span class="token function">curl</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">-H</span> <span class="token string">"Content-type: application/json"</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$json</span>"</span> <span class="token string">"<span class="token variable">$uploadHostDailyCheckReportApi</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">getchage_file_24h</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"############################ 文件检查 #############################"</span>
    <span class="token assign-left variable">check2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.sh'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check21</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.asp'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check22</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.php'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check23</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.aspx'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check24</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.jsp'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check25</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.html'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check26</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">'*.htm'</span> <span class="token parameter variable">-mtime</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check9</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> core <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">check10</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/crontab<span class="token variable">)</span></span>
<span class="token assign-left variable">check12</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token parameter variable">-alt</span> /usr/bin <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span><span class="token variable">)</span></span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF

############################查看所有被修改过的文件返回最近24小时内的############################
<span class="token variable">$&#123;check2&#125;</span>
<span class="token variable">$&#123;check21&#125;</span>
<span class="token variable">$&#123;check22&#125;</span>
<span class="token variable">$&#123;check23&#125;</span>
<span class="token variable">$&#123;check24&#125;</span>
<span class="token variable">$&#123;check25&#125;</span>
<span class="token variable">$&#123;check26&#125;</span>
<span class="token variable">$&#123;line&#125;</span>

############################检查定时文件的完整性############################
<span class="token variable">$&#123;check10&#125;</span>
<span class="token variable">$&#123;line&#125;</span>

############################查看系统命令是否被替换############################
<span class="token variable">$&#123;check12&#125;</span>
<span class="token variable">$&#123;line&#125;</span>
EOF</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-name function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
version
getSystemStatus
getCpuStatus
getMemStatus
getDiskStatus
getNetworkStatus
getListenStatus
getProcessStatus
getServiceStatus
getAutoStartStatus
getLoginStatus
getCronStatus
getUserStatus
getPasswordStatus
getSudoersStatus
getJDKStatus
getFirewallStatus
getSSHStatus
getSyslogStatus
getSNMPStatus
getNTPStatus
getInstalledStatus
getchage_file_24h
<span class="token punctuation">&#125;</span>


<span class="token comment">#执行检查并保存检查结果</span>
check <span class="token operator">></span> <span class="token variable">$RESULTFILE</span>

<span class="token builtin class-name">echo</span> <span class="token string">"检查结果：<span class="token variable">$RESULTFILE</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span><span class="token variable">`</span></span> 阿里云PHP企业平台巡检报告"</span>  <span class="token operator">|</span> mail <span class="token parameter variable">-a</span> <span class="token variable">$RESULTFILE</span> <span class="token parameter variable">-s</span> <span class="token string">"阿里云PHP企业平台巡检报告"</span> h@163.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>END</p>

            </div>

            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/Linux/">#Linux</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/02/05/Cloudflare%205XX%20%E9%94%99%E8%AF%AF%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">Cloudflare 5XX 错误故障排除</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2021/11/24/troubleshooting%20Kubernetes%20deployments/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">troubleshooting Kubernetes deployments</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%B7%A1%E6%A3%80%E5%86%85%E5%AE%B9"><span class="nav-number">1.</span> <span class="nav-text">主要巡检内容:</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2018</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Devin hao</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script>




    <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script>



    <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script>



    <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script>
        
            <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script>
        
        
            <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script>
        
    
</div>


    <script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
